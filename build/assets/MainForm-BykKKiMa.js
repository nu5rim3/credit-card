import{c as te,r as ae,a as M,b as se,_ as O,d as _,v as ne,e as re,f as $,R as I,g as b,u as ie,h as K,j as t,w as le,D as oe,B as U,i as ce,k as ue,m as G,n as de,l as me,I as V}from"./index-C5HwXoF9.js";import{_ as fe,V as pe,q as ge,o as he,s as B,u as ve,L as ye,t as xe}from"./index-BmGyOisy.js";import{m as be}from"./textConvertor-BsdEMnbp.js";/**
 * @license lucide-react v0.383.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=te("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Ne=n=>async o=>{var l,c,i,u;o(ae());try{const a=await M.post(`/otp-request/${n}`);o(se(a.data)),O.success(a.data.message??"OTP sent to your mobile")}catch(a){a?(o(_((c=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:c.error)),O.error((u=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:u.error)):o(_("An unknown error occurred"))}},Se=(n,o,l)=>async c=>{var i,u,a,j,m,v,f;c(ne());try{const r=await M.post(`/otp-request/v2/validate/${o}/${l}`);c(re(r.data)),O.success(r.data.message??"OTP code successfully validated!"),((i=r==null?void 0:r.data)==null?void 0:i.stage)==="PENDING"?n("/personal-detail"):((u=r==null?void 0:r.data)==null?void 0:u.stage)==="PENDING_DOCUMENT"?n("/document-detail"):((a=r==null?void 0:r.data)==null?void 0:a.stage)==="COMPLETED"&&n("/complete")}catch(r){r?(c($((m=(j=r==null?void 0:r.response)==null?void 0:j.data)==null?void 0:m.error)),O.error((f=(v=r==null?void 0:r.response)==null?void 0:v.data)==null?void 0:f.error)):c($("An unknown error occurred"))}};var z=function(n){return typeof n=="object"&&n!==null},Pe=function(n){var o=n.value,l=o===void 0?"":o,c=n.numInputs,i=c===void 0?4:c,u=n.onChange,a=n.onPaste,j=n.renderInput,m=n.shouldAutoFocus,v=m===void 0?!1:m,f=n.inputType,r=f===void 0?"text":f,N=n.renderSeparator,y=n.placeholder,p=n.containerStyle,P=n.inputStyle,T=n.skipDefaultStyles,C=T===void 0?!1:T,w=I.useState(0),h=w[0],q=w[1],D=I.useRef([]),k=function(){return l?l.toString().split(""):[]},F=r==="number"||r==="tel";I.useEffect(function(){D.current=D.current.slice(0,i)},[i]),I.useEffect(function(){var e;v&&((e=D.current[0])===null||e===void 0||e.focus())},[v]);var J=function(){if(typeof y=="string"){if(y.length===i)return y;y.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},L=function(e){var s=F?!isNaN(Number(e)):typeof e=="string";return s&&e.trim().length===1},W=function(e){var s=e.target.value;L(s)&&(E(s),S(h+1))},X=function(e){var s=e.nativeEvent,d=e.target.value;if(!L(d)){if(d.length===i){var g=d.split("").some(function(x){return!L(x)});g||(R(d.split("")),S(i-1))}s.data===null&&s.inputType==="deleteContentBackward"&&(e.preventDefault(),E(""),S(h-1)),e.target.value=""}},H=function(e){return function(s){q(s),e.target.select()}},Q=function(){q(h-1)},Y=function(e){var s=k();[e.code,e.key].includes("Backspace")?(e.preventDefault(),E(""),S(h-1)):e.code==="Delete"?(e.preventDefault(),E("")):e.code==="ArrowLeft"?(e.preventDefault(),S(h-1)):e.code==="ArrowRight"||e.key===s[h]?(e.preventDefault(),S(h+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},S=function(e){var s,d,g=Math.max(Math.min(i-1,e),0);D.current[g]&&((s=D.current[g])===null||s===void 0||s.focus(),(d=D.current[g])===null||d===void 0||d.select(),q(g))},E=function(e){var s=k();s[h]=e[0],R(s)},R=function(e){var s=e.join("");u(s)},Z=function(e){var s;e.preventDefault();var d=k(),g=h,x=e.clipboardData.getData("text/plain").slice(0,i-h).split("");if(!(F&&x.some(function(ee){return isNaN(Number(ee))}))){for(var A=0;A<i;++A)A>=h&&x.length>0&&(d[A]=(s=x.shift())!==null&&s!==void 0?s:"",g++);S(g),R(d)}};return I.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},z(p)&&p),className:typeof p=="string"?p:void 0,onPaste:a},Array.from({length:i},function(e,s){return s}).map(function(e){var s,d,g;return I.createElement(I.Fragment,{key:e},j({value:(s=k()[e])!==null&&s!==void 0?s:"",placeholder:(g=(d=J())===null||d===void 0?void 0:d[e])!==null&&g!==void 0?g:void 0,ref:function(x){return D.current[e]=x},onChange:W,onFocus:function(x){return H(x)(e)},onBlur:Q,onKeyDown:Y,onPaste:Z,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(C?{}:{width:"1em",textAlign:"center"},z(P)?P:{}),className:typeof P=="string"?P:void 0,type:r,inputMode:F?"numeric":"text",onInput:X},e),e<i-1&&(typeof N=="function"?N(e):N))}))};const we=({mobile:n,referenceId:o,isOpen:l,setIsOpen:c})=>{const[i,u]=b.useState(!0),a=ie(),[j,m]=b.useState(0),v=K(),[f,r]=b.useState(""),N=()=>{o!==""&&f!==""&&v(Se(a,o,f))},y=()=>{u(!0),r(""),v(Ne(o)),m(p=>p+1)};return b.useEffect(()=>{f.length===6&&N()},[f]),t.jsx(fe,{static:!0,open:l,onClose:()=>c(!1),className:"relative z-50",children:t.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-2 bg-primary/50 backdrop-blur-lg",children:t.jsxs(pe,{className:"space-y-4 border bg-primary-50 p-2 rounded-lg shadow-lg text-center text-primary",children:[t.jsx(ge,{className:"font-semibold text-xl",children:"OTP Verification"}),t.jsxs(le,{className:"text-gray-500 px-5",children:["Please check the mobile and enter the verification code",t.jsx("br",{}),"(",be(n),")"]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(oe,{size:100,isPlaying:!0,duration:60,colors:["#1e3a8a","#1e40af","#1d4ed8","#be123c"],colorsTime:[60,40,10,0],onComplete:()=>{u(!1)},children:({remainingTime:p})=>p},j)}),t.jsx("div",{className:"bg-gray-200 rounded-lg flex justify-center items-center",children:t.jsx(Pe,{containerStyle:"flex flex-1 justify-between items-center px-5 py-5",value:f,onChange:r,numInputs:6,renderSeparator:t.jsx("span",{children:" "}),renderInput:p=>t.jsx("input",{...p}),inputStyle:{width:"2.5rem",height:"2.5rem",fontSize:"1.5rem",borderRadius:"0.5rem",border:"1px solid #1c34c6"}})}),t.jsx("div",{className:"flex justify-center sm:justify-end gap-4",children:t.jsx(U,{onClick:()=>y(),variant:"secondary",disabled:i,children:"Resend"})})]})})})},De=n=>async o=>{var l,c,i,u;o(ce());try{const a=await M.post("/master/v2",n);o(ue(a.data)),O.success(a.data.message)}catch(a){a?(o(G((c=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:c.error)),O.error((u=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:u.error)):o(G("An unknown error occurred"))}},Ie=he({nic:B().min(1,"NIC Number is required").regex(/^(?:\d{9}[vVxX]|\d{12})$/,"Invalid NIC number"),email:B().min(1,"Email Address is required").email("Invalid email address (e.g. sample@sample.com)"),mobileNumber:B().min(1,"Mobile Number is required").regex(/^(?:[0-9]{10})$/,"Invalid phone number (e.g. 0712345678)")}),ke=()=>{var N,y,p,P,T,C;const{register:n,handleSubmit:o,formState:{errors:l}}=ve({resolver:xe(Ie)}),[c,i]=b.useState(!1),[u,a]=b.useState(null),j=K(),{data:m,loading:v}=de(w=>w.userLogin),f=b.useCallback(w=>{a(w),j(De(w))},[]),r=b.useMemo(()=>u&&t.jsx(we,{setIsOpen:i,isOpen:c,mobile:u.mobileNumber,referenceId:(m==null?void 0:m.referenceNo)??""}),[u,c]);return b.useEffect(()=>{m!==null&&i(!0)},[m]),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-card-pattern flex justify-center items-center min-h-screen",children:t.jsxs("div",{className:"bg-primary-50 p-8 rounded-lg shadow-md w-full my-2 max-w-md animate-fade-up animate-duration-[3000ms] animate-once",children:[t.jsx("img",{className:"w-32 mb-3 animate-fade-up animate-duration-[1200ms] animate-once",src:me}),t.jsxs("div",{className:"bg-white border rounded-lg p-3 text-primary-950 animate-fade-up animate-duration-[1500ms] animate-once",children:[t.jsx("h3",{className:"text-base mb-2",children:"Welcome to LOLC Credit Card"}),t.jsx("h3",{className:"text-sm mb-2",children:"Required Documents"}),t.jsxs("ul",{className:"list-disc list-inside text-sm",children:[t.jsxs("li",{className:"",children:["NIC or Driving License ",t.jsx("br",{}),"    (Both Sides)"]}),t.jsxs("li",{className:"",children:["Income Proof ",t.jsx("br",{}),"    (Latest Payslip or 03 months Bank Statements)"]}),t.jsxs("li",{className:"",children:["Billing Proof ",t.jsx("br",{}),"    (Electricity/ Water Bill)"]})]}),t.jsxs("p",{className:"mt-3 text-sm",children:["Use gallery to select and attach multiple documents.",t.jsx("br",{}),"Allowed document types - (PDF, JPG, JPEG, PNG)"]})]}),t.jsx("form",{onSubmit:o(f),children:t.jsxs("div",{className:"flex flex-col gap-5 mt-3 animate-fade-up animate-duration-[2000ms] animate-once",children:[t.jsx(V,{type:"text",label:"NIC",error:(y=(N=l==null?void 0:l.nic)==null?void 0:N.message)==null?void 0:y.toString(),required:!0,...n("nic")}),t.jsx(V,{type:"tel",label:"Mobile",error:(P=(p=l==null?void 0:l.mobileNumber)==null?void 0:p.message)==null?void 0:P.toString(),required:!0,...n("mobileNumber")}),t.jsx(V,{type:"email",label:"Email",className:"normal-case",error:(C=(T=l==null?void 0:l.email)==null?void 0:T.message)==null?void 0:C.toString(),required:!0,...n("email")}),t.jsxs(U,{type:"submit",variant:"primary",className:"w-full flex flex-row items-center justify-between gap-2 mt-3",children:["Start ",v?t.jsx(ye,{className:"animate-spin animate-infinite"}):t.jsx(je,{})]})]})})]})}),r]})};export{ke as default};
