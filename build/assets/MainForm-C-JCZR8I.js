import{c as te,r as ae,a as M,b as re,_ as T,d as _,v as se,e as ne,f as $,R as I,g as y,u as ie,h as K,j as t,w as le,D as oe,B as U,i as ce,k as ue,m as G,n as de,l as me,I as V}from"./index-Bf5nJgUi.js";import{_ as fe,V as pe,q as ge,o as he,s as B,u as ve,L as ye,t as be}from"./index-2LvIP5-G.js";import{m as xe}from"./textConvertor-BsdEMnbp.js";/**
 * @license lucide-react v0.383.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=te("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Ne=s=>async i=>{i(ae());try{const a=await M.post(`/otp-request/${s}`);i(re(a.data)),T.success(a.data.message??"OTP sent to your mobile")}catch(a){a instanceof Error?i(_(a.message)):i(_("An unknown error occurred"))}},Se=(s,i,a)=>async d=>{var l,f,b;d(se());try{const n=await M.post(`/otp-request/v2/validate/${i}/${a}`);d(ne(n.data)),T.success(n.data.message??"OTP code successfully validated!"),((l=n==null?void 0:n.data)==null?void 0:l.stage)==="PENDING"?s("/personal-detail"):((f=n==null?void 0:n.data)==null?void 0:f.stage)==="PENDING_DOCUMENT"?s("/document-detail"):((b=n==null?void 0:n.data)==null?void 0:b.stage)==="COMPLETED"&&s("/complete")}catch(n){n instanceof Error?(d($(n.message)),T.error(n.message)):d($("An unknown error occurred"))}};var z=function(s){return typeof s=="object"&&s!==null},Pe=function(s){var i=s.value,a=i===void 0?"":i,d=s.numInputs,l=d===void 0?4:d,f=s.onChange,b=s.onPaste,n=s.renderInput,p=s.shouldAutoFocus,S=p===void 0?!1:p,g=s.inputType,x=g===void 0?"text":g,j=s.renderSeparator,h=s.placeholder,c=s.containerStyle,P=s.inputStyle,O=s.skipDefaultStyles,C=O===void 0?!1:O,w=I.useState(0),m=w[0],q=w[1],D=I.useRef([]),E=function(){return a?a.toString().split(""):[]},R=x==="number"||x==="tel";I.useEffect(function(){D.current=D.current.slice(0,l)},[l]),I.useEffect(function(){var e;S&&((e=D.current[0])===null||e===void 0||e.focus())},[S]);var J=function(){if(typeof h=="string"){if(h.length===l)return h;h.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},F=function(e){var r=R?!isNaN(Number(e)):typeof e=="string";return r&&e.trim().length===1},W=function(e){var r=e.target.value;F(r)&&(k(r),N(m+1))},X=function(e){var r=e.nativeEvent,o=e.target.value;if(!F(o)){if(o.length===l){var u=o.split("").some(function(v){return!F(v)});u||(L(o.split("")),N(l-1))}r.data===null&&r.inputType==="deleteContentBackward"&&(e.preventDefault(),k(""),N(m-1)),e.target.value=""}},H=function(e){return function(r){q(r),e.target.select()}},Q=function(){q(m-1)},Y=function(e){var r=E();[e.code,e.key].includes("Backspace")?(e.preventDefault(),k(""),N(m-1)):e.code==="Delete"?(e.preventDefault(),k("")):e.code==="ArrowLeft"?(e.preventDefault(),N(m-1)):e.code==="ArrowRight"||e.key===r[m]?(e.preventDefault(),N(m+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},N=function(e){var r,o,u=Math.max(Math.min(l-1,e),0);D.current[u]&&((r=D.current[u])===null||r===void 0||r.focus(),(o=D.current[u])===null||o===void 0||o.select(),q(u))},k=function(e){var r=E();r[m]=e[0],L(r)},L=function(e){var r=e.join("");f(r)},Z=function(e){var r;e.preventDefault();var o=E(),u=m,v=e.clipboardData.getData("text/plain").slice(0,l-m).split("");if(!(R&&v.some(function(ee){return isNaN(Number(ee))}))){for(var A=0;A<l;++A)A>=m&&v.length>0&&(o[A]=(r=v.shift())!==null&&r!==void 0?r:"",u++);N(u),L(o)}};return I.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},z(c)&&c),className:typeof c=="string"?c:void 0,onPaste:b},Array.from({length:l},function(e,r){return r}).map(function(e){var r,o,u;return I.createElement(I.Fragment,{key:e},n({value:(r=E()[e])!==null&&r!==void 0?r:"",placeholder:(u=(o=J())===null||o===void 0?void 0:o[e])!==null&&u!==void 0?u:void 0,ref:function(v){return D.current[e]=v},onChange:W,onFocus:function(v){return H(v)(e)},onBlur:Q,onKeyDown:Y,onPaste:Z,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(C?{}:{width:"1em",textAlign:"center"},z(P)?P:{}),className:typeof P=="string"?P:void 0,type:x,inputMode:R?"numeric":"text",onInput:X},e),e<l-1&&(typeof j=="function"?j(e):j))}))};const we=({mobile:s,referenceId:i,isOpen:a,setIsOpen:d})=>{const[l,f]=y.useState(!0),b=ie(),[n,p]=y.useState(0),S=K(),[g,x]=y.useState(""),j=()=>{i!==""&&g!==""&&S(Se(b,i,g))},h=()=>{f(!0),x(""),S(Ne(i)),p(c=>c+1)};return y.useEffect(()=>{g.length===6&&j()},[g]),t.jsx(fe,{static:!0,open:a,onClose:()=>d(!1),className:"relative z-50",children:t.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-4 bg-primary/50 backdrop-blur-lg",children:t.jsxs(pe,{className:"max-w-lg space-y-4 border bg-primary-50 p-5 rounded-lg shadow-lg text-center text-primary",children:[t.jsx(ge,{className:"font-semibold text-xl",children:"OTP Verification"}),t.jsxs(le,{className:"text-gray-500",children:["Please check the mobile and enter the verification code",t.jsx("br",{}),"(",xe(s),")"]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(oe,{size:100,isPlaying:!0,duration:60,colors:["#1e3a8a","#1e40af","#1d4ed8","#be123c"],colorsTime:[60,40,10,0],onComplete:()=>{f(!1)},children:({remainingTime:c})=>c},n)}),t.jsx("div",{className:"bg-gray-100 p-5 rounded-lg",children:t.jsx(Pe,{containerStyle:"grid grid-cols-6 gap-2 justify-center",value:g,onChange:x,numInputs:6,renderSeparator:t.jsx("span",{children:"&"}),renderInput:c=>t.jsx("input",{...c}),inputStyle:{width:"2.5rem",height:"2.5rem",fontSize:"1.5rem",borderRadius:"0.5rem",border:"1px solid #1c34c6"}})}),t.jsx("div",{className:"flex justify-center sm:justify-end gap-4",children:t.jsx(U,{onClick:()=>h(),variant:"secondary",disabled:l,children:"Resend"})})]})})})},De=s=>async i=>{i(ce());try{const a=await M.post("/master/v2",s);i(ue(a.data)),T.success(a.data.message)}catch(a){a instanceof Error?(console.error("[ERROR] - ",a),i(G(a.message)),T.error(a.message)):i(G("An unknown error occurred"))}},Ie=he({nic:B().min(1,"NIC Number is required").regex(/^(?:\d{9}[vVxX]|\d{12})$/,"Invalid NIC number"),email:B().min(1,"Email Address is required").email("Invalid email address (e.g. sample@sample.com)"),mobileNumber:B().min(1,"Mobile Number is required").regex(/^(?:[0-9]{10})$/,"Invalid phone number (e.g. 0712345678)")}),Ee=()=>{var j,h,c,P,O,C;const{register:s,handleSubmit:i,formState:{errors:a}}=ve({resolver:be(Ie)}),[d,l]=y.useState(!1),[f,b]=y.useState(null),n=K(),{data:p,loading:S}=de(w=>w.userLogin),g=y.useCallback(w=>{b(w),n(De(w))},[]),x=y.useMemo(()=>f&&t.jsx(we,{setIsOpen:l,isOpen:d,mobile:f.mobileNumber,referenceId:(p==null?void 0:p.referenceNo)??""}),[f,d]);return y.useEffect(()=>{p!==null&&l(!0)},[p]),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-card-pattern flex justify-center items-center min-h-screen",children:t.jsxs("div",{className:"bg-primary-50 p-8 rounded-lg shadow-md w-full my-2 max-w-md animate-fade-up animate-duration-[3000ms] animate-once",children:[t.jsx("img",{className:"w-32 mb-3 animate-fade-up animate-duration-[1200ms] animate-once",src:me}),t.jsxs("div",{className:"bg-white border rounded-lg p-3 text-primary-950 animate-fade-up animate-duration-[1500ms] animate-once",children:[t.jsx("h3",{className:"text-base mb-2",children:"Welcome to LOLC Credit Card"}),t.jsx("h3",{className:"text-sm mb-2",children:"Required Documents"}),t.jsxs("ul",{className:"list-disc list-inside text-sm",children:[t.jsxs("li",{className:"",children:["NIC or Driving License ",t.jsx("br",{}),"    (Both Sides)"]}),t.jsxs("li",{className:"",children:["Income Proof ",t.jsx("br",{}),"    (Latest Payslip or 03 months Bank Statements)"]}),t.jsxs("li",{className:"",children:["Billing Proof ",t.jsx("br",{}),"    (Electricity/ Water Bill)"]})]}),t.jsxs("p",{className:"mt-3 text-sm",children:["Use gallery to select and attach multiple documents.",t.jsx("br",{}),"Allowed document types - (PDF, JPG, JPEG, PNG)"]})]}),t.jsx("form",{onSubmit:i(g),children:t.jsxs("div",{className:"flex flex-col gap-5 mt-3 animate-fade-up animate-duration-[2000ms] animate-once",children:[t.jsx(V,{type:"text",label:"NIC",error:(h=(j=a==null?void 0:a.nic)==null?void 0:j.message)==null?void 0:h.toString(),required:!0,...s("nic")}),t.jsx(V,{type:"tel",label:"Mobile",error:(P=(c=a==null?void 0:a.mobileNumber)==null?void 0:c.message)==null?void 0:P.toString(),required:!0,...s("mobileNumber")}),t.jsx(V,{type:"email",label:"Email",error:(C=(O=a==null?void 0:a.email)==null?void 0:O.message)==null?void 0:C.toString(),required:!0,...s("email")}),t.jsxs(U,{type:"submit",variant:"primary",className:"w-full flex flex-row items-center justify-between gap-2 mt-3",children:["Start ",S?t.jsx(ye,{className:"animate-spin animate-infinite"}):t.jsx(je,{})]})]})})]})}),x]})};export{Ee as default};
