import{r as te,b as _,c as ae,_ as O,d as $,v as se,e as ne,f as G,R as D,g as j,a as re,h as K,j as t,i as ie,V as le,q as oe,w as ce,D as ue,B as M,k as de,m as me,n as U,u as fe,o as pe,l as ge,I as V}from"./index-DbbjwCJe.js";import{m as he}from"./textConvertor-BsdEMnbp.js";import{o as ve,s as B,u as be,L as ye,A as xe,t as je}from"./index-BG_0F2E5.js";const Ne=r=>async o=>{var m,c,i,l;o(te());try{const s=await _.post(`/otp-request/${r}`);o(ae(s.data)),O.success(s.data.message??"OTP sent to your mobile")}catch(s){s?(o($((c=(m=s==null?void 0:s.response)==null?void 0:m.data)==null?void 0:c.error)),O.error((l=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:l.error)):o($("An unknown error occurred"))}},Pe=(r,o,m)=>async c=>{var i,l,s,y,v,b,f;c(se());try{const a=await _.post(`/otp-request/v2/validate/${o}/${m}`);c(ne(a.data)),O.success(a.data.message??"OTP code successfully validated!"),((i=a==null?void 0:a.data)==null?void 0:i.stage)==="PENDING"?r("/personal-detail"):((l=a==null?void 0:a.data)==null?void 0:l.stage)==="PENDING_DOCUMENT"?r("/document-detail"):((s=a==null?void 0:a.data)==null?void 0:s.stage)==="COMPLETED"&&r("/complete")}catch(a){a?(c(G((v=(y=a==null?void 0:a.response)==null?void 0:y.data)==null?void 0:v.error)),O.error((f=(b=a==null?void 0:a.response)==null?void 0:b.data)==null?void 0:f.error)):c(G("An unknown error occurred"))}};var z=function(r){return typeof r=="object"&&r!==null},Se=function(r){var o=r.value,m=o===void 0?"":o,c=r.numInputs,i=c===void 0?4:c,l=r.onChange,s=r.onPaste,y=r.renderInput,v=r.shouldAutoFocus,b=v===void 0?!1:v,f=r.inputType,a=f===void 0?"text":f,N=r.renderSeparator,P=r.placeholder,h=r.containerStyle,w=r.inputStyle,T=r.skipDefaultStyles,E=T===void 0?!1:T,C=D.useState(0),u=C[0],I=C[1],p=D.useRef([]),k=function(){return m?m.toString().split(""):[]},L=a==="number"||a==="tel";D.useEffect(function(){p.current=p.current.slice(0,i)},[i]),D.useEffect(function(){var e;b&&((e=p.current[0])===null||e===void 0||e.focus())},[b]);var J=function(){if(typeof P=="string"){if(P.length===i)return P;P.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},F=function(e){var n=L?!isNaN(Number(e)):typeof e=="string";return n&&e.trim().length===1},W=function(e){var n=e.target.value;F(n)&&(A(n),S(u+1))},X=function(e){var n=e.nativeEvent,d=e.target.value;if(!F(d)){if(d.length===i){var g=d.split("").some(function(x){return!F(x)});g||(R(d.split("")),S(i-1))}n.data===null&&n.inputType==="deleteContentBackward"&&(e.preventDefault(),A(""),S(u-1)),e.target.value=""}},H=function(e){return function(n){I(n),e.target.select()}},Q=function(){I(u-1)},Y=function(e){var n=k();[e.code,e.key].includes("Backspace")?(e.preventDefault(),A(""),S(u-1)):e.code==="Delete"?(e.preventDefault(),A("")):e.code==="ArrowLeft"?(e.preventDefault(),S(u-1)):e.code==="ArrowRight"||e.key===n[u]?(e.preventDefault(),S(u+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},S=function(e){var n,d,g=Math.max(Math.min(i-1,e),0);p.current[g]&&((n=p.current[g])===null||n===void 0||n.focus(),(d=p.current[g])===null||d===void 0||d.select(),I(g))},A=function(e){var n=k();n[u]=e[0],R(n)},R=function(e){var n=e.join("");l(n)},Z=function(e){var n;e.preventDefault();var d=k(),g=u,x=e.clipboardData.getData("text/plain").slice(0,i-u).split("");if(!(L&&x.some(function(ee){return isNaN(Number(ee))}))){for(var q=0;q<i;++q)q>=u&&x.length>0&&(d[q]=(n=x.shift())!==null&&n!==void 0?n:"",g++);S(g),R(d)}};return D.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},z(h)&&h),className:typeof h=="string"?h:void 0,onPaste:s},Array.from({length:i},function(e,n){return n}).map(function(e){var n,d,g;return D.createElement(D.Fragment,{key:e},y({value:(n=k()[e])!==null&&n!==void 0?n:"",placeholder:(g=(d=J())===null||d===void 0?void 0:d[e])!==null&&g!==void 0?g:void 0,ref:function(x){return p.current[e]=x},onChange:W,onFocus:function(x){return H(x)(e)},onBlur:Q,onKeyDown:Y,onPaste:Z,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(E?{}:{width:"1em",textAlign:"center"},z(w)?w:{}),className:typeof w=="string"?w:void 0,type:a,inputMode:L?"numeric":"text",onInput:X},e),e<i-1&&(typeof N=="function"?N(e):N))}))};const we=({mobile:r,referenceId:o,isOpen:m,setIsOpen:c})=>{const[i,l]=j.useState(!0),s=re(),[y,v]=j.useState(0),b=K(),[f,a]=j.useState(""),N=()=>{o!==""&&f!==""&&b(Pe(s,o,f))},P=()=>{l(!0),a(""),b(Ne(o)),v(h=>h+1)};return j.useEffect(()=>{f.length===6&&N()},[f]),t.jsx(ie,{static:!0,open:m,onClose:()=>c(!1),className:"relative z-50",children:t.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-2 bg-primary/50 backdrop-blur-lg",children:t.jsxs(le,{className:"space-y-4 border bg-primary-50 p-2 rounded-lg shadow-lg text-center text-primary",children:[t.jsx(oe,{className:"font-semibold text-xl",children:"OTP Verification"}),t.jsxs(ce,{className:"text-gray-500 px-5",children:["Please check the mobile and enter the verification code",t.jsx("br",{}),"(",he(r),")"]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(ue,{size:100,isPlaying:!0,duration:60,colors:["#1e3a8a","#1e40af","#1d4ed8","#be123c"],colorsTime:[60,40,10,0],onComplete:()=>{l(!1)},children:({remainingTime:h})=>h},y)}),t.jsx("div",{className:"bg-gray-200 rounded-lg flex justify-center items-center",children:t.jsx(Se,{containerStyle:"flex flex-1 justify-between items-center px-5 py-5",value:f,onChange:a,numInputs:6,inputType:"number",renderSeparator:t.jsx("span",{children:" "}),renderInput:h=>t.jsx("input",{...h}),inputStyle:{width:"2.5rem",height:"2.5rem",fontSize:"1.5rem",borderRadius:"0.5rem",border:"1px solid #1c34c6"}})}),t.jsxs("div",{className:"flex justify-center sm:justify-end gap-4",children:[t.jsx(M,{onClick:()=>P(),variant:"secondary",disabled:i,children:"Resend"}),t.jsx(M,{onClick:()=>N(),variant:"primary",disabled:!i||f.length!==6,children:"Verify"})]})]})})})},De=r=>async o=>{var m,c,i,l;o(de());try{const s=await _.post("/master/v2",r);o(me(s.data)),O.success(s.data.message)}catch(s){s?(o(U((c=(m=s==null?void 0:s.response)==null?void 0:m.data)==null?void 0:c.error)),O.error((l=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:l.error)):o(U("An unknown error occurred"))}},Ie=ve({nic:B().min(1,"NIC Number is required").regex(/^(?:\d{9}[vVxX]|\d{12})$/,"Invalid NIC number"),email:B().min(1,"Email Address is required").email("Invalid email address (e.g. sample@sample.com)"),mobileNumber:B().min(1,"Mobile Number is required").regex(/^(?:[0-9]{10})$/,"Invalid phone number (e.g. 0712345678)")}),Ee=()=>{var w,T,E,C,u,I;const r=fe(),m=new URLSearchParams(r.search).get("ved"),{register:c,handleSubmit:i,formState:{errors:l}}=be({resolver:je(Ie)}),[s,y]=j.useState(!1),[v,b]=j.useState(null),f=K(),{data:a,loading:N}=pe(p=>p.userLogin),P=j.useCallback(p=>{b(p),f(De({...p,nic:p.nic.toLocaleUpperCase(),identifire:m??null}))},[]),h=j.useMemo(()=>v&&(a==null?void 0:a.stage)!=="COMPLETED"&&t.jsx(we,{setIsOpen:y,isOpen:s,mobile:v.mobileNumber,referenceId:(a==null?void 0:a.referenceNo)??""}),[a==null?void 0:a.referenceNo]);return j.useEffect(()=>{a!==null&&y(!0)},[a]),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-card-pattern flex justify-center items-center min-h-screen",children:t.jsxs("div",{className:"bg-primary-50 p-8 rounded-lg shadow-md w-full my-2 max-w-md animate-fade-up animate-duration-[3000ms] animate-once",children:[t.jsx("img",{className:"w-32 mb-3 animate-fade-up animate-duration-[1200ms] animate-once",src:ge}),t.jsxs("div",{className:"bg-white border rounded-lg p-3 text-primary-950 animate-fade-up animate-duration-[1500ms] animate-once",children:[t.jsx("h3",{className:"text-base mb-2",children:"Welcome to LOLC Credit Card"}),t.jsx("h3",{className:"text-sm mb-2",children:"Required Documents"}),t.jsxs("ul",{className:"list-disc list-inside text-sm",children:[t.jsxs("li",{className:"",children:["NIC or Driving License ",t.jsx("br",{}),"    (Both Sides)"]}),t.jsxs("li",{className:"",children:["Income Proof ",t.jsx("br",{}),"    (Latest Payslip or 03 months Bank Statements)"]}),t.jsxs("li",{className:"",children:["Billing Proof ",t.jsx("br",{}),"    (Electricity/ Water Bill)"]})]}),t.jsxs("p",{className:"mt-3 text-sm",children:["Use gallery to select and attach multiple documents.",t.jsx("br",{}),"Allowed document types - (PDF, JPG, JPEG, PNG)"]})]}),t.jsx("form",{onSubmit:i(P),children:t.jsxs("div",{className:"flex flex-col gap-5 mt-3 animate-fade-up animate-duration-[2000ms] animate-once",children:[t.jsx(V,{type:"text",label:"NIC",error:(T=(w=l==null?void 0:l.nic)==null?void 0:w.message)==null?void 0:T.toString(),required:!0,...c("nic")}),t.jsx(V,{type:"tel",label:"Mobile",error:(C=(E=l==null?void 0:l.mobileNumber)==null?void 0:E.message)==null?void 0:C.toString(),required:!0,...c("mobileNumber"),ruleLabel:"Enter mobile number (e.g. 0712345678)"}),t.jsx(V,{type:"email",label:"Email",className:"normal-case",error:(I=(u=l==null?void 0:l.email)==null?void 0:u.message)==null?void 0:I.toString(),required:!0,...c("email")}),t.jsxs(M,{type:"submit",variant:"primary",className:"w-full flex flex-row items-center justify-between gap-2 mt-3",children:["Start ",N?t.jsx(ye,{className:"animate-spin animate-infinite"}):t.jsx(xe,{})]})]})})]})}),h]})};export{Ee as default};
