import{c as te,r as ae,a as _,b as re,_ as C,d as $,v as se,e as ne,f as G,R as I,g as b,u as ie,h as U,j as t,w as le,D as oe,B as M,i as ce,k as ue,m as z,n as de,l as me,I as R}from"./index-DOZkR35Q.js";import{_ as fe,V as pe,q as ge,m as he}from"./textConvertor-ByU2ctba.js";import{o as ve,s as B,u as ye,L as be,t as xe}from"./index-BG7ihFNu.js";/**
 * @license lucide-react v0.383.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=te("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Ne=r=>async i=>{i(ae());try{const s=await _.post(`/otp-request/${r}`);i(re(s.data)),C.success(s.data.message??"OTP sended to your mobile")}catch(s){s instanceof Error?i($(s.message)):i($("An unknown error occurred"))}},Se=(r,i,s)=>async d=>{var l,f,x;d(se());try{const n=await _.post(`/otp-request/v2/validate/${i}/${s}`);d(ne(n.data)),C.success(n.data.message??"OTP Code Successfully Validated!"),((l=n==null?void 0:n.data)==null?void 0:l.stage)==="PENDING"?r("/personal-detail"):((f=n==null?void 0:n.data)==null?void 0:f.stage)==="PENDING_DOCUMENT"?r("/document-detail"):((x=n==null?void 0:n.data)==null?void 0:x.stage)==="COMPLETED"&&r("/complete")}catch(n){n instanceof Error?(d(G(n.message)),C.error(n.message)):d(G("An unknown error occurred"))}};var K=function(r){return typeof r=="object"&&r!==null},Pe=function(r){var i=r.value,s=i===void 0?"":i,d=r.numInputs,l=d===void 0?4:d,f=r.onChange,x=r.onPaste,n=r.renderInput,g=r.shouldAutoFocus,S=g===void 0?!1:g,p=r.inputType,j=p===void 0?"text":p,h=r.renderSeparator,v=r.placeholder,c=r.containerStyle,P=r.inputStyle,O=r.skipDefaultStyles,T=O===void 0?!1:O,w=I.useState(0),m=w[0],q=w[1],D=I.useRef([]),E=function(){return s?s.toString().split(""):[]},F=j==="number"||j==="tel";I.useEffect(function(){D.current=D.current.slice(0,l)},[l]),I.useEffect(function(){var e;S&&((e=D.current[0])===null||e===void 0||e.focus())},[S]);var J=function(){if(typeof v=="string"){if(v.length===l)return v;v.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},V=function(e){var a=F?!isNaN(Number(e)):typeof e=="string";return a&&e.trim().length===1},W=function(e){var a=e.target.value;V(a)&&(k(a),N(m+1))},X=function(e){var a=e.nativeEvent,o=e.target.value;if(!V(o)){if(o.length===l){var u=o.split("").some(function(y){return!V(y)});u||(L(o.split("")),N(l-1))}a.data===null&&a.inputType==="deleteContentBackward"&&(e.preventDefault(),k(""),N(m-1)),e.target.value=""}},H=function(e){return function(a){q(a),e.target.select()}},Q=function(){q(m-1)},Y=function(e){var a=E();[e.code,e.key].includes("Backspace")?(e.preventDefault(),k(""),N(m-1)):e.code==="Delete"?(e.preventDefault(),k("")):e.code==="ArrowLeft"?(e.preventDefault(),N(m-1)):e.code==="ArrowRight"||e.key===a[m]?(e.preventDefault(),N(m+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},N=function(e){var a,o,u=Math.max(Math.min(l-1,e),0);D.current[u]&&((a=D.current[u])===null||a===void 0||a.focus(),(o=D.current[u])===null||o===void 0||o.select(),q(u))},k=function(e){var a=E();a[m]=e[0],L(a)},L=function(e){var a=e.join("");f(a)},Z=function(e){var a;e.preventDefault();var o=E(),u=m,y=e.clipboardData.getData("text/plain").slice(0,l-m).split("");if(!(F&&y.some(function(ee){return isNaN(Number(ee))}))){for(var A=0;A<l;++A)A>=m&&y.length>0&&(o[A]=(a=y.shift())!==null&&a!==void 0?a:"",u++);N(u),L(o)}};return I.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},K(c)&&c),className:typeof c=="string"?c:void 0,onPaste:x},Array.from({length:l},function(e,a){return a}).map(function(e){var a,o,u;return I.createElement(I.Fragment,{key:e},n({value:(a=E()[e])!==null&&a!==void 0?a:"",placeholder:(u=(o=J())===null||o===void 0?void 0:o[e])!==null&&u!==void 0?u:void 0,ref:function(y){return D.current[e]=y},onChange:W,onFocus:function(y){return H(y)(e)},onBlur:Q,onKeyDown:Y,onPaste:Z,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(T?{}:{width:"1em",textAlign:"center"},K(P)?P:{}),className:typeof P=="string"?P:void 0,type:j,inputMode:F?"numeric":"text",onInput:X},e),e<l-1&&(typeof h=="function"?h(e):h))}))};const we=({mobile:r,referenceId:i,isOpen:s,setIsOpen:d})=>{const[l,f]=b.useState(!0),x=ie(),[n,g]=b.useState(0),S=U(),[p,j]=b.useState(""),h=()=>{i!==""&&p!==""&&S(Se(x,i,p))},v=()=>{f(!0),j(""),S(Ne(i)),g(c=>c+1)};return b.useEffect(()=>{p.length===6&&h()},[p]),t.jsx(fe,{static:!0,open:s,onClose:()=>d(!1),className:"relative z-50",children:t.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-4 bg-primary/50 backdrop-blur-lg",children:t.jsxs(pe,{className:"max-w-lg space-y-4 border bg-primary-50 p-5 rounded-lg shadow-lg text-center text-primary",children:[t.jsx(ge,{className:"font-semibold text-xl",children:"OTP Verification"}),t.jsxs(le,{className:"text-gray-500",children:["Please Check the mobile and enter the verification code",t.jsx("br",{}),"(",he(r),")"]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(oe,{size:100,isPlaying:!0,duration:60,colors:["#1e3a8a","#1e40af","#1d4ed8","#be123c"],colorsTime:[60,40,10,0],onComplete:()=>{f(!1)},children:({remainingTime:c})=>c},n)}),t.jsx("div",{className:"bg-gray-100 p-5 rounded-lg",children:t.jsx(Pe,{containerStyle:"grid grid-cols-6 gap-2 justify-center",value:p,onChange:j,numInputs:6,renderSeparator:t.jsx("span",{children:"-"}),renderInput:c=>t.jsx("input",{...c}),inputStyle:{width:"2.5rem",height:"2.5rem",fontSize:"1.5rem",borderRadius:"0.5rem",border:"1px solid #1c34c6"}})}),t.jsxs("div",{className:"flex justify-center sm:justify-end gap-4",children:[t.jsx(M,{onClick:()=>v(),variant:"secondary",disabled:l,children:"Resend"}),t.jsx(M,{onClick:()=>h(),variant:"primary",disabled:!l||p.length!==6,children:"Verify"})]})]})})})},De=r=>async i=>{i(ce());try{const s=await _.post("/master/v2",r);i(ue(s.data)),C.success(s.data.message)}catch(s){s instanceof Error?(i(z(s.message)),C.error(s.message)):i(z("An unknown error occurred"))}},Ie=ve({nic:B().min(1,"NIC Number is required").regex(/^(?:\d{9}[VX]|\d{12})$/,"Invalid NIC number (e.g. 123456789V)"),email:B().min(1,"Email Address is required").email("Invalid email address (e.g. sample@sample.com)"),mobileNumber:B().min(1,"Mobile Number is required").regex(/^(?:\+\d{1,3}\d{10}|[0-9]{10})$/,"Invalid phone number (e.g. +94712345678)")}),Ee=()=>{var h,v,c,P,O,T;const{register:r,handleSubmit:i,formState:{errors:s}}=ye({resolver:xe(Ie)}),[d,l]=b.useState(!1),[f,x]=b.useState(null),n=U(),{data:g,loading:S}=de(w=>w.userLogin),p=b.useCallback(w=>{x(w),n(De(w))},[]),j=b.useMemo(()=>f&&t.jsx(we,{setIsOpen:l,isOpen:d,mobile:f.mobileNumber,referenceId:(g==null?void 0:g.referenceNo)??""}),[f,d]);return b.useEffect(()=>{g!==null&&l(!0)},[g]),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-card-pattern flex justify-center items-center min-h-screen",children:t.jsxs("div",{className:"bg-primary-50 p-8 rounded-lg shadow-md w-full my-2 max-w-md animate-fade-up animate-duration-[3000ms] animate-once",children:[t.jsx("img",{className:"w-32 mb-3 animate-fade-up animate-duration-[1200ms] animate-once",src:me}),t.jsxs("div",{className:"bg-white border rounded-lg p-3 text-primary-950 animate-fade-up animate-duration-[1500ms] animate-once",children:[t.jsx("h3",{className:"text-base mb-2",children:"Welcome to LOLC Credit Card"}),t.jsx("h3",{className:"text-sm mb-2",children:"Required Documents"}),t.jsxs("ul",{className:"list-disc list-inside text-sm",children:[t.jsxs("li",{className:"",children:["NIC or Driving License ",t.jsx("br",{}),"    (Both Sides)"]}),t.jsxs("li",{className:"",children:["Income Proof ",t.jsx("br",{}),"    (Latest Payslip or 03 months Bank Statements)"]}),t.jsxs("li",{className:"",children:["Billing Proof ",t.jsx("br",{}),"    (Electricity/ Water Bill)"]})]}),t.jsxs("p",{className:"mt-3 text-sm",children:["Use gallery to select and attach multiple documents.",t.jsx("br",{}),"Allowed document types - (PDF, JPG, JPEG, PNG)"]})]}),t.jsx("form",{onSubmit:i(p),children:t.jsxs("div",{className:"flex flex-col gap-5 mt-3 animate-fade-up animate-duration-[2000ms] animate-once",children:[t.jsx(R,{type:"text",label:"NIC",error:(v=(h=s==null?void 0:s.nic)==null?void 0:h.message)==null?void 0:v.toString(),required:!0,...r("nic")}),t.jsx(R,{type:"tel",label:"Mobile",error:(P=(c=s==null?void 0:s.mobileNumber)==null?void 0:c.message)==null?void 0:P.toString(),required:!0,...r("mobileNumber")}),t.jsx(R,{type:"email",label:"Email",error:(T=(O=s==null?void 0:s.email)==null?void 0:O.message)==null?void 0:T.toString(),required:!0,...r("email")}),t.jsxs(M,{type:"submit",variant:"primary",className:"w-full flex flex-row items-center justify-between gap-2 mt-3",children:["Start ",S?t.jsx(be,{className:"animate-spin animate-infinite"}):t.jsx(je,{})]})]})})]})}),j]})};export{Ee as default};
