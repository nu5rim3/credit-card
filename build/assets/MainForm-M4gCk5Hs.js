import{r as te,b as _,c as ae,_ as C,d as $,v as se,e as ne,f as G,R as D,g as P,a as re,h as K,j as t,i as ie,V as le,q as oe,w as ce,D as ue,B as M,k as de,m as me,n as U,u as fe,o as pe,l as ge,I as V}from"./index-Dl6Chj2r.js";import{m as he}from"./textConvertor-BsdEMnbp.js";import{o as ve,s as B,u as be,L as ye,A as xe,t as je}from"./index-Ddy6Y74b.js";const Ne=r=>async l=>{var g,c,i,u;l(te());try{const a=await _.post(`/otp-request/${r}`);l(ae(a.data)),C.success(a.data.message??"OTP sent to your mobile")}catch(a){a?(l($((c=(g=a==null?void 0:a.response)==null?void 0:g.data)==null?void 0:c.error)),C.error((u=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:u.error)):l($("An unknown error occurred"))}},Pe=(r,l,g)=>async c=>{var i,u,a,d,x,b,m;c(se());try{const n=await _.post(`/otp-request/v2/validate/${l}/${g}`);c(ne(n.data)),C.success(n.data.message??"OTP code successfully validated!"),((i=n==null?void 0:n.data)==null?void 0:i.stage)==="PENDING"?r("/personal-detail"):((u=n==null?void 0:n.data)==null?void 0:u.stage)==="PENDING_DOCUMENT"?r("/document-detail"):((a=n==null?void 0:n.data)==null?void 0:a.stage)==="COMPLETED"&&r("/complete")}catch(n){n?(c(G((x=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:x.error)),C.error((m=(b=n==null?void 0:n.response)==null?void 0:b.data)==null?void 0:m.error)):c(G("An unknown error occurred"))}};var z=function(r){return typeof r=="object"&&r!==null},Se=function(r){var l=r.value,g=l===void 0?"":l,c=r.numInputs,i=c===void 0?4:c,u=r.onChange,a=r.onPaste,d=r.renderInput,x=r.shouldAutoFocus,b=x===void 0?!1:x,m=r.inputType,n=m===void 0?"text":m,S=r.renderSeparator,o=r.placeholder,h=r.containerStyle,O=r.inputStyle,k=r.skipDefaultStyles,A=k===void 0?!1:k,E=D.useState(0),f=E[0],T=E[1],y=D.useRef([]),w=function(){return g?g.toString().split(""):[]},j=n==="number"||n==="tel";D.useEffect(function(){y.current=y.current.slice(0,i)},[i]),D.useEffect(function(){var e;b&&((e=y.current[0])===null||e===void 0||e.focus())},[b]);var J=function(){if(typeof o=="string"){if(o.length===i)return o;o.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},F=function(e){var s=j?!isNaN(Number(e)):typeof e=="string";return s&&e.trim().length===1},W=function(e){var s=e.target.value;F(s)&&(q(s),I(f+1))},X=function(e){var s=e.nativeEvent,p=e.target.value;if(!F(p)){if(p.length===i){var v=p.split("").some(function(N){return!F(N)});v||(R(p.split("")),I(i-1))}s.data===null&&s.inputType==="deleteContentBackward"&&(e.preventDefault(),q(""),I(f-1)),e.target.value=""}},H=function(e){return function(s){T(s),e.target.select()}},Q=function(){T(f-1)},Y=function(e){var s=w();[e.code,e.key].includes("Backspace")?(e.preventDefault(),q(""),I(f-1)):e.code==="Delete"?(e.preventDefault(),q("")):e.code==="ArrowLeft"?(e.preventDefault(),I(f-1)):e.code==="ArrowRight"||e.key===s[f]?(e.preventDefault(),I(f+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},I=function(e){var s,p,v=Math.max(Math.min(i-1,e),0);y.current[v]&&((s=y.current[v])===null||s===void 0||s.focus(),(p=y.current[v])===null||p===void 0||p.select(),T(v))},q=function(e){var s=w();s[f]=e[0],R(s)},R=function(e){var s=e.join("");u(s)},Z=function(e){var s;e.preventDefault();var p=w(),v=f,N=e.clipboardData.getData("text/plain").slice(0,i-f).split("");if(!(j&&N.some(function(ee){return isNaN(Number(ee))}))){for(var L=0;L<i;++L)L>=f&&N.length>0&&(p[L]=(s=N.shift())!==null&&s!==void 0?s:"",v++);I(v),R(p)}};return D.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},z(h)&&h),className:typeof h=="string"?h:void 0,onPaste:a},Array.from({length:i},function(e,s){return s}).map(function(e){var s,p,v;return D.createElement(D.Fragment,{key:e},d({value:(s=w()[e])!==null&&s!==void 0?s:"",placeholder:(v=(p=J())===null||p===void 0?void 0:p[e])!==null&&v!==void 0?v:void 0,ref:function(N){return y.current[e]=N},onChange:W,onFocus:function(N){return H(N)(e)},onBlur:Q,onKeyDown:Y,onPaste:Z,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(A?{}:{width:"1em",textAlign:"center"},z(O)?O:{}),className:typeof O=="string"?O:void 0,type:n,inputMode:j?"numeric":"text",onInput:X},e),e<i-1&&(typeof S=="function"?S(e):S))}))};const Ie=({mobile:r,referenceId:l,isOpen:g,setIsOpen:c})=>{const[i,u]=P.useState(!0),a=re(),[d,x]=P.useState(0),b=K(),[m,n]=P.useState(""),S=()=>{l!==""&&m!==""&&b(Pe(a,l,m))},o=()=>{u(!0),n(""),b(Ne(l)),x(h=>h+1)};return P.useEffect(()=>{m.length===6&&S()},[m]),t.jsx(ie,{static:!0,open:g,onClose:()=>c(!1),className:"relative z-50",children:t.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-2 bg-primary/50 backdrop-blur-lg",children:t.jsxs(le,{className:"space-y-4 border bg-primary-50 p-2 rounded-lg shadow-lg text-center text-primary",children:[t.jsx(oe,{className:"font-semibold text-xl",children:"OTP Verification"}),t.jsxs(ce,{className:"text-gray-500 px-5",children:["Please check the mobile and enter the verification code",t.jsx("br",{}),"(",he(r),")"]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(ue,{size:100,isPlaying:!0,duration:60,colors:["#1e3a8a","#1e40af","#1d4ed8","#be123c"],colorsTime:[60,40,10,0],onComplete:()=>{u(!1)},children:({remainingTime:h})=>h},d)}),t.jsx("div",{className:"bg-gray-200 rounded-lg flex justify-center items-center",children:t.jsx(Se,{containerStyle:"flex flex-1 justify-between items-center px-5 py-5",value:m,onChange:n,numInputs:6,inputType:"number",renderSeparator:t.jsx("span",{children:" "}),renderInput:h=>t.jsx("input",{...h}),inputStyle:{width:"2.5rem",height:"2.5rem",fontSize:"1.5rem",borderRadius:"0.5rem",border:"1px solid #1c34c6"}})}),t.jsxs("div",{className:"flex justify-center sm:justify-end gap-4",children:[t.jsx(M,{onClick:()=>o(),variant:"secondary",disabled:i,children:"Resend"}),t.jsx(M,{onClick:()=>S(),variant:"primary",disabled:!i||m.length!==6,children:"Verify"})]})]})})})},we=r=>async l=>{var g,c,i,u;l(de());try{const a=await _.post("/master/v2",r);l(me(a.data)),C.success(a.data.message)}catch(a){a?(l(U((c=(g=a==null?void 0:a.response)==null?void 0:g.data)==null?void 0:c.error)),C.error((u=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:u.error)):l(U("An unknown error occurred"))}},De=ve({nic:B().min(1,"NIC Number is required").regex(/^(?:\d{9}[vVxX]|\d{12})$/,"Invalid NIC number"),email:B().min(1,"Email Address is required").email("Invalid email address (e.g. sample@sample.com)"),mobileNumber:B().min(1,"Mobile Number is required").regex(/^(?:[0-9]{10})$/,"Invalid phone number (e.g. 0712345678)")}),Ee=()=>{var A,E,f,T,y,w;const r=fe(),l=new URLSearchParams(r.search),g=l.get("ved"),c=l.get("emp"),i=l.get("shp"),{register:u,handleSubmit:a,formState:{errors:d}}=be({resolver:je(De)}),[x,b]=P.useState(!1),[m,n]=P.useState(null),S=K(),{data:o,loading:h}=pe(j=>j.userLogin),O=P.useCallback(j=>{n(j),S(we({...j,nic:j.nic.toLocaleUpperCase(),identifire:g??null,shopIdentifire:i??null,userIdentifire:c??null}))},[]),k=P.useMemo(()=>m&&(o==null?void 0:o.stage)!=="COMPLETED"&&t.jsx(Ie,{setIsOpen:b,isOpen:x,mobile:m.mobileNumber,referenceId:(o==null?void 0:o.referenceNo)??""}),[o==null?void 0:o.referenceNo]);return P.useEffect(()=>{o!==null&&b(!0)},[o]),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-card-pattern flex justify-center items-center min-h-screen",children:t.jsxs("div",{className:"bg-primary-50 p-8 rounded-lg shadow-md w-full my-2 max-w-md animate-fade-up animate-duration-[3000ms] animate-once",children:[t.jsx("img",{className:"w-32 mb-3 animate-fade-up animate-duration-[1200ms] animate-once",src:ge}),t.jsxs("div",{className:"bg-white border rounded-lg p-3 text-primary-950 animate-fade-up animate-duration-[1500ms] animate-once",children:[t.jsx("h3",{className:"text-base mb-2",children:"Welcome to LOLC Credit Card"}),t.jsx("h3",{className:"text-sm mb-2",children:"Required Documents"}),t.jsxs("ul",{className:"list-disc list-inside text-sm",children:[t.jsxs("li",{className:"",children:["NIC or Driving License ",t.jsx("br",{}),"    (Both Sides)"]}),t.jsxs("li",{className:"",children:["Income Proof ",t.jsx("br",{}),"    (Latest Payslip or 03 months Bank Statements)"]}),t.jsxs("li",{className:"",children:["Billing Proof ",t.jsx("br",{}),"    (Electricity/ Water Bill)"]})]}),t.jsxs("p",{className:"mt-3 text-sm",children:["Use gallery to select and attach multiple documents.",t.jsx("br",{}),"Allowed document types - (PDF, JPG, JPEG, PNG)"]})]}),t.jsx("form",{onSubmit:a(O),children:t.jsxs("div",{className:"flex flex-col gap-5 mt-3 animate-fade-up animate-duration-[2000ms] animate-once",children:[t.jsx(V,{type:"text",label:"NIC",error:(E=(A=d==null?void 0:d.nic)==null?void 0:A.message)==null?void 0:E.toString(),required:!0,...u("nic")}),t.jsx(V,{type:"tel",label:"Mobile",error:(T=(f=d==null?void 0:d.mobileNumber)==null?void 0:f.message)==null?void 0:T.toString(),required:!0,...u("mobileNumber"),ruleLabel:"Enter mobile number (e.g. 0712345678)"}),t.jsx(V,{type:"email",label:"Email",className:"normal-case",error:(w=(y=d==null?void 0:d.email)==null?void 0:y.message)==null?void 0:w.toString(),required:!0,...u("email")}),t.jsxs(M,{type:"submit",variant:"primary",className:"w-full flex flex-row items-center justify-between gap-2 mt-3",disabled:h,children:["Start ",h?t.jsx(ye,{className:"animate-spin animate-infinite"}):t.jsx(xe,{})]})]})})]})}),k]})};export{Ee as default};
